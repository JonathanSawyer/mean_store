!function(){"use strict";angular.module("storeApp.admin",["ui.bootstrap","storeApp.products","storeApp.checkout"]).controller("adminMainCtrl",["$rootScope","$location","$scope","productService","orderService","selectedTabService",function(t,e,r,n,o,c){t.user&&"admin"===t.user.role?(r.currentTab=c.get(),r.updateTabs=function(){r.active={products:!1,orders:!1},r.active[r.currentTab]=!0},r.updateTabs(),r.tabSelected=function(t){c.set(t),r.currentTab=t,r.updateTabs()},n.getAll({deleted:!0}).then(function(t){r.products=t}),r.editProduct=function(t){e.path("/admin/products/"+t._id)},r.createProduct=function(){e.path("/admin/products/new")},o.getAll().then(function(t){t.forEach(function(t){t.total=t.products.reduce(function(t,e){return t+e.quantity*e.price},0)}),r.orders=t}),r.viewOrder=function(t){e.path("/admin/orders/"+t._id)}):e.path("/")}]).controller("productEditCtrl",["$scope","$routeParams","$location","productService",function(t,e,r,n){"new"!==e.id?(t.mode="edit",n.getById(e.id).then(function(e){t.product=e})):(t.mode="create",t.product={}),n.getCategories().then(function(e){t.categories=e}),t.save=function(e){"edit"===t.mode?n.update(e).then(function(){r.path("/admin")}):n.create(e).then(function(){r.path("/admin")})},t.remove=function(t){n.remove(t).then(function(){r.path("/admin")})},t.undelete=function(t){t.deleted=!1,n.update(t).then(function(){r.path("/admin")})}}]).controller("orderViewCtrl",["$scope","$routeParams","$location","orderService","productService",function(t,e,r,n,o){n.getById(e.id).then(function(e){t.order=e,t.products={};var r=0;e.products.forEach(function(e){r+=e.quantity*e.price,o.getById(e.product).then(function(r){t.products[e.product]=r})}),t.total=r}),t.setAsSent=function(){t.order.sent=!0,n.update(t.order).then(function(){r.path("/admin")})}}]).factory("selectedTabService",function(){var t="products";return{get:function(){return t},set:function(e){t=e}}})}(),function(){"use strict";angular.module("storeApp",["ngRoute","ui.bootstrap","ngStorage","storeApp.frontPage","storeApp.products","storeApp.cart","storeApp.users","storeApp.search","storeApp.admin","storeApp.checkout"]).controller("mainCtrl",["$scope","$location","$rootScope","$http","productService","cartService","userService",function(t,e,r,n,o,c,u){t.categories=[],o.getCategories().then(function(e){t.categories=e}),u.checkauth().then(function(t){t.auth&&(r.user=t.user)}),t.logout=function(){r.user=null,u.logout()},t.search=function(){var r=t.searchText;t.searchText="",e.path("/search").search("query",r)},t.findProducts=function(t){return n.get("/products/search?name="+t).then(function(t){return t.data.map(function(t){return t.name})})},t.typeAheadSelected=function(){t.search()},t.addToCart=function(t){c.addToCart(t)}}]).config(["$routeProvider",function(t){t.when("/",{templateUrl:"partials/frontpage.html",controller:"frontpageCtrl"}).when("/products/:category",{templateUrl:"partials/productList.html",controller:"productListCtrl"}).when("/products/:category/:productId",{templateUrl:"partials/productView.html",controller:"productViewCtrl"}).when("/cart",{templateUrl:"partials/cart.html",controller:"cartCtrl"}).when("/login",{templateUrl:"partials/login.html",controller:"loginCtrl"}).when("/signup",{templateUrl:"partials/signup.html",controller:"signupCtrl"}).when("/search",{templateUrl:"partials/search.html",controller:"searchCtrl"}).when("/admin",{templateUrl:"partials/adminMain.html",controller:"adminMainCtrl"}).when("/admin/products/:id",{templateUrl:"partials/adminProductEdit.html",controller:"productEditCtrl"}).when("/admin/orders/:id",{templateUrl:"partials/adminOrderView.html",controller:"orderViewCtrl"}).when("/checkout",{templateUrl:"partials/checkout.html",controller:"checkoutCtrl"})}]).filter("capitalize",function(){return function(t){return t?(t=t.toUpperCase(),t.length>1&&(t=t.substring(0,1)+t.substring(1).toLowerCase()),t):void 0}})}(),function(){"use strict";angular.module("storeApp.cart",["ui.bootstrap"]).controller("cartCtrl",["$scope","cartService","$modal","$location",function(t,e,r,n){t.clearCart=function(){var t=r.open({templateUrl:"clearCartModal.html",controller:"clearCartCtrl",size:"sm"});t.result.then(function(){e.clearCart()})},t.cartHasItems=function(){var t=e.getCart();return t&&t.length>0},t.goToOrder=function(){n.path("/checkout")}}]).controller("clearCartCtrl",["$scope","$modalInstance",function(t,e){t.ok=function(){e.close()},t.cancel=function(){e.dismiss()}}]).factory("cartService",function(){function t(t){for(var r=0;r<e.length;r++)if(e[r]._id===t)return e[r];return null}var e=[];return{addToCart:function(r){var n=t(r._id);n?n.quantity++:(r.quantity=1,e.push(r))},getCart:function(){return e},incrementQuantity:function(e){var r=t(e._id);r&&r.quantity++},decrementQuantity:function(e){var r=t(e._id);r&&r.quantity>1&&r.quantity--},removeItem:function(t){for(var r=0;r<e.length;r++)if(e[r]._id===t._id){e.splice(r,1);break}},clearCart:function(){e=[]}}}).directive("cartIndicator",["cartService",function(t){return{restrict:"E",replace:!0,scope:{},template:'<a href="#/cart">{{cartCount()}} items in cart : {{cartPrice() | currency}}</a>',link:function(e){e.cartCount=function(){var e=t.getCart(),r=e.reduce(function(t,e){return t+e.quantity},0);return r},e.cartPrice=function(){var e=t.getCart(),r=e.reduce(function(t,e){return t+e.quantity*e.price},0);return r}}}}]).directive("cartTable",["cartService",function(t){return{restrict:"E",templateUrl:"partials/cartTable.html",replace:!1,scope:{},link:function(e){e.getCart=function(){return t.getCart()},e.increment=function(e){t.incrementQuantity(e)},e.decrement=function(e){t.decrementQuantity(e)},e.remove=function(e){t.removeItem(e)},e.cartPrice=function(){var e=t.getCart(),r=e.reduce(function(t,e){return t+e.quantity*e.price},0);return r}}}}])}(),function(){"use strict";angular.module("storeApp.checkout",["storeApp.cart"]).controller("checkoutCtrl",["$scope","$rootScope","$location","orderService","cartService",function(t,e,r,n,o){if(e.user){var c=e.user;t.info={firstName:c.firstName,lastName:c.lastName,streetAddress:c.streetAddress,postalCode:c.postalCode,city:c.city}}t.submitOrder=function(){n.create(t.info).then(function(){o.clearCart(),t.orderDone=!0})},t.backToCart=function(){r.path("/cart")},t.backToFront=function(){r.path("/")}}]).factory("orderService",["$http","$q","cartService",function(t,e,r){return{create:function(n){var o=r.getCart(),c={receiver:n,products:[]};return o.forEach(function(t){c.products.push({product:t._id,quantity:t.quantity,price:t.price})}),t.post("/orders",c).then(function(t){return t.data},function(t){return e.reject(t.status)})},getAll:function(){return t.get("/orders").then(function(t){return t.data},function(t){return e.reject(t.status)})},getById:function(r){return t.get("/orders/"+r).then(function(t){return t.data},function(t){return e.reject(t.status)})},update:function(r){return t.put("/orders/"+r._id,r).then(function(t){return t.data},function(t){return e.reject(t.status)})}}}])}(),function(){"use strict";angular.module("storeApp.frontPage",[]).controller("frontpageCtrl",function(){})}(),function(){"use strict";angular.module("storeApp.products",["ngRoute"]).controller("productListCtrl",["$scope","productService","$routeParams",function(t,e,r){t.category=r.category,e.getByCategory(r.category).then(function(e){t.products=e})}]).controller("productViewCtrl",["$scope","$routeParams","productService",function(t,e,r){var n=e.productId;r.getById(n).then(function(e){t.product=e})}]).factory("productService",["$http","$q",function(t,e){return{getCategories:function(){return t.get("/products/categories").then(function(t){return t.data},function(t){return e.reject(t.status)})},getAll:function(r){var n="/products";return r&&r.deleted&&(n+="?deleted=true"),t.get(n).then(function(t){return t.data},function(t){return e.reject(t.status)})},getByCategory:function(r){return t.get("/products/search?category="+r).then(function(t){return t.data},function(t){return e.reject(t.status)})},getById:function(r){return t.get("/products/"+r).then(function(t){return t.data},function(t){return e.reject(t.status)})},find:function(r){return t.get("/products/search?name="+r).then(function(t){return t.data},function(t){return e.reject(t.status)})},update:function(r){return t.put("/products/"+r._id,r).then(function(t){return t.data},function(t){return e.reject(t.status)})},remove:function(r){return t["delete"]("/products/"+r._id).then(function(t){return t.data},function(t){return e.reject(t.status)})},create:function(r){return t.post("/products",r).then(function(t){return t.data},function(t){return e.reject(t.status)})}}}])}(),function(){"use strict";angular.module("storeApp.search",["storeApp.products"]).controller("searchCtrl",["$routeParams","$scope","productService",function(t,e,r){e.query=t.query,r.find(e.query).then(function(t){e.products=t})}])}(),function(){"use strict";angular.module("storeApp.users",["ngStorage"]).factory("userService",["$http","$localStorage",function(t,e){var r="reauthToken",n="userEmail";return{login:function(r){return t.post("/users/login",r).then(function(t){return t.data&&t.data.token&&t.data.user&&e.$reset({reauthToken:t.data.token,userEmail:t.data.user.email}),t.data.user},function(t){return $q.reject(t.status)})},signup:function(e){return t.post("/users/signup",e).then(function(t){return t.data},function(t){return $q.reject(t.status)})},logout:function(){return delete e[r],delete e[n],t.get("/users/logout").then(function(t){return t.data},function(t){return $q.reject(t.status)})},checkauth:function(){return t.get("/users/checkauth").then(function(o){if(o.data&&o.data.auth)return o.data;var c=e[r],u=e[n];return c&&u?t.post("/users/reauth",{email:u,token:c}).then(function(t){return t.data&&t.data.auth&&t.data.token?(e.$reset({reauthToken:t.data.token,userEmail:t.data.user.email}),{auth:!0,user:t.data.user}):{auth:!1}},function(t){return $q.reject(t.status)}):{auth:!1}},function(t){return $q.reject(t.status)})}}}]).controller("loginCtrl",["$rootScope","$scope","$location","userService",function(t,e,r,n){e.login=function(e){n.login(e).then(function(e){t.user=e,r.path("/")})}}]).controller("signupCtrl",["$rootScope","$scope","$location","userService",function(t,e,r,n){e.signup=function(e){n.signup(e).then(function(e){t.user=e,r.path("/")})}}])}();